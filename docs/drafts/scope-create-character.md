# 功能探讨: 创建角色系统

## 基本信息

- **创建时间**: 2026-02-02
- **关联项目蓝图**: #1

## 功能目标

为"人在江湖"水墨风武侠 MUD 游戏设计一套独特的角色创建系统。融合传统 MUD 自由度、紫微斗数命理系统、以及独创的三丹田属性体系，打造区别于市面所有武侠游戏的角色创建体验。

## 核心设计理念

1. **不在创建时绑定门派** — 门派是游戏过程中自己探索拜师加入的
2. **出身决定起点，不决定终点** — 初始选择影响开局，不限制后续发展
3. **紫微命盘驱动命格** — 用真实紫微斗数排盘生成角色命格，独创特色
4. **绝对公平** — 可分配点数和属性上限总和完全固定，杜绝刷号

## 属性系统: 三丹田六属性

从中医/道家修炼体系出发，以精气神为核心：

### 架构

| 丹田               | 位置 | 主宰                | 下辖属性   |
| ------------------ | ---- | ------------------- | ---------- |
| **上丹田**（泥丸） | 眉心 | **神** — 意念、感知 | 慧根、心眼 |
| **中丹田**（膻中） | 胸口 | **气** — 内力、气息 | 气海、脉络 |
| **下丹田**（气海） | 腹部 | **精** — 体魄、根基 | 筋骨、血气 |

### 六属性详解

| 属性     | 来源      | 影响                                                   |
| -------- | --------- | ------------------------------------------------------ |
| **慧根** | 上丹田·神 | 武学领悟速度、秘籍研读、对话选项（聪慧程度）           |
| **心眼** | 上丹田·神 | 战斗感知、危险预判、发现隐藏事物（战斗直觉）           |
| **气海** | 中丹田·气 | 内力总量、内功威力、远程/内家功法伤害                  |
| **脉络** | 中丹田·气 | 内力流转速度、恢复速率、经脉承受力（决定能学几门内功） |
| **筋骨** | 下丹田·精 | 外功伤害、负重、抗击打、外家功法威力                   |
| **血气** | 下丹田·精 | 生命总量、体力恢复、中毒/受伤抵抗                      |

### 设计亮点

- **有层次结构** — 精气神 → 三丹田 → 六属性，玩家感受到修炼体系
- **气海与脉络分离** — 内力容量 vs 流转速度，厚积薄发型 vs 快攻型
- **慧根与心眼分离** — 学习能力 vs 战斗直觉，书呆子 vs 街头混混
- **为 MUD 文字交互设计** — 慧根影响对话选项，心眼影响环境描述丰富度

### 数值规则（防刷号核心）

- **可分配根基点**: 固定 18 点（所有玩家相同）
- **属性上限总和**: 固定 42 点（所有玩家相同）
- **命格只决定上限分布**，不改变总量

示例:

| 命格     | 慧根 | 心眼 | 气海 | 脉络 | 筋骨 | 血气 | 上限总和 | 可分配 |
| -------- | ---- | ---- | ---- | ---- | ---- | ---- | -------- | ------ |
| 天机化变 | 10   | 9    | 7    | 7    | 4    | 5    | 42       | 18     |
| 七杀破军 | 5    | 9    | 5    | 4    | 10   | 9    | 42       | 18     |
| 天府坐镇 | 7    | 7    | 7    | 7    | 7    | 7    | 42       | 18     |
| 贪狼桃花 | 6    | 10   | 6    | 5    | 6    | 9    | 42       | 18     |

## 命格系统: 紫微斗数驱动

### 技术基础

- 使用 [iztro](https://github.com/SylarLong/iztro) 开源 TypeScript 紫微斗数排盘库
- Server 端计算（使用服务器时间，防止客户端篡改）
- 排盘结果存入数据库，与角色绑定

### 映射规则

#### 命宫主星 → 命格名称

| 命宫主星 | 游戏命格 | 性格倾向                    |
| -------- | -------- | --------------------------- |
| 紫微     | 紫微在命 | 领袖型，属性均衡偏高        |
| 天机     | 天机化变 | 智谋型，慧根/心眼上限高     |
| 太阳     | 日照中天 | 豪爽型，筋骨/血气上限高     |
| 武曲     | 武曲临门 | 刚猛型，筋骨/气海上限高     |
| 天同     | 天同福泽 | 安逸型，脉络/血气上限高     |
| 廉贞     | 廉贞入命 | 复杂型，极端偏科            |
| 天府     | 天府坐镇 | 稳重型，属性均衡            |
| 太阴     | 太阴化清 | 内敛型，气海/脉络上限高     |
| 贪狼     | 贪狼桃花 | 社交型，心眼高，贵人运好    |
| 巨门     | 巨门暗曜 | 多疑型，慧根高但劫数多      |
| 天相     | 天相辅弼 | 辅助型，脉络/慧根上限高     |
| 天梁     | 天梁化禄 | 稳健型，血气/脉络高         |
| 七杀     | 七杀破军 | 激进型，筋骨/心眼高但劫数多 |
| 破军     | 破军先锋 | 破坏型，大起大落            |

#### 四化 → 命运维度

| 四化 | 游戏维度 | 效果             |
| ---- | -------- | ---------------- |
| 化禄 | 机缘     | 奇遇品质提升     |
| 化权 | 命数     | 主线剧情更顺畅   |
| 化科 | 贵人     | NPC 关系更好获取 |
| 化忌 | 劫数     | 负面事件更频繁   |

#### 十二宫星耀 → 属性上限分布

| 紫微宫位        | 游戏属性 |
| --------------- | -------- |
| 命宫 + 身宫     | 慧根上限 |
| 迁移宫 + 福德宫 | 心眼上限 |
| 财帛宫 + 官禄宫 | 气海上限 |
| 疾厄宫          | 脉络上限 |
| 兄弟宫 + 父母宫 | 筋骨上限 |
| 子女宫 + 夫妻宫 | 血气上限 |

注意: 映射算法需保证上限总和恒等于 42。

### 命格展示

创建流程中显示游戏化包装:

```
╔═══════════════════════════════════════════╗
║                                           ║
║           命格：天机化变                    ║
║                                           ║
║   「机关算尽天下事，一朝悟道入青云」          ║
║                                           ║
║   命数：通达    ★★★★☆                    ║
║   贵人：中平    ★★★☆☆                    ║
║   劫数：暗涌    ★★☆☆☆                    ║
║   机缘：频至    ★★★★☆                    ║
║                                           ║
║   ── 此命格由阁下踏入江湖之时辰推演 ──      ║
║                                           ║
╚═══════════════════════════════════════════╝
```

角色创建完成后，个人信息中可查看完整紫微星盘详情页。

## 出身系统

6 种出身，影响初始属性倾向和开局条件，不限制后续发展:

| 出身         | 故事                     | 属性倾向       | 独特开局                 |
| ------------ | ------------------------ | -------------- | ------------------------ |
| **世家子弟** | 武林世家的后人，家道中落 | 慧根+、气海+   | 起步带一本残缺家传秘籍   |
| **江湖浪子** | 从小在市井中摸爬滚打     | 心眼+、血气+   | 起步有一些银两和江湖关系 |
| **书院学子** | 读圣贤书的文人，偶入江湖 | 慧根++、筋骨-  | 识字能力强，能读更多秘籍 |
| **边塞军卒** | 从军归来的退役兵士       | 筋骨+、血气+   | 起步带一把制式兵器       |
| **山野药童** | 深山采药人的徒弟         | 脉络+、心眼+   | 懂基础药理，能辨认草药   |
| **乞丐流民** | 一无所有的底层人         | 全属性平均偏低 | 福缘最高，奇遇概率大增   |

注意: 出身的"属性倾向"是对根基点分配的建议/加成，不改变上限总和和可分配点数。

## 角色创建流程

```
第一步：选出身（手动选择 6 选 1）
  ↓
第二步：命格天成（自动，基于创建时间的紫微排盘）
  → 展示游戏化命格页面
  → 显示属性上限分布
  ↓
第三步：分配根基点（手动，18 点固定）
  → 在属性上限范围内自由分配
  ↓
第四步：取名 → 确认预览 → 进入江湖
```

## 方案探讨记录

### 考虑过的替代方案

| 方案                        | 优点               | 缺点                   | 结论                       |
| --------------------------- | ------------------ | ---------------------- | -------------------------- |
| 经典 MUD 式（纯手动分配）   | 简单直接           | 无特色，千篇一律       | 部分采用（根基点分配）     |
| MMO 职业式（选门派）        | 上手快             | 限制自由度，不适合 MUD | 放弃（门派改为游戏内拜师） |
| 纯随机式（全骰子）          | 有趣味             | 刷号问题严重           | 放弃                       |
| 紫微排盘 + 固定总量（采用） | 独创、防刷、有深度 | 映射算法需仔细调校     | 采用                       |

### 关键决策

1. **属性上限总和固定 42** — 杜绝刷号，命格只决定分布不决定强弱
2. **根基点固定 18** — 所有玩家起跑线完全公平
3. **Server 端排盘** — 用服务器时间防止客户端篡改
4. **命格展示分两层** — 创建时游戏化包装，创建后可查完整星盘

## 与现有功能的关系

- **依赖**: Account 账号系统（已完成）、WebSocket 通信（已完成）
- **影响**: 需要新建 Character 数据实体，扩展 WebSocket 消息类型
- **复用**: 水墨风 UI 组件（LinearGradient、GameAlert 等）

## 技术依赖

- [iztro](https://github.com/SylarLong/iztro) — TypeScript 紫微斗数排盘库（npm 包）
- [react-iztro](https://github.com/SylarLong/react-iztro) — React 紫微星盘展示组件（可选）

## 开放问题（留给 PRD/Design Doc 阶段）

- 紫微十二宫 → 六属性上限的具体算法（需保证总和恒等于 42）
- 出身"属性倾向"的具体数值加成
- 命格诗句的文案库
- 角色数据库表结构设计
- 创建角色的 WebSocket 消息协议

## 参考资料

- 逆水寒: 气海属性、内功系统、经脉穴位设计
- 燕云十六声: 武学流派、自由武学搭配
- 北大侠客行 MUD: 精气神属性体系、根骨/悟性/福缘
- 太吾绘卷: 随机出身、天赋特质、五行节气
- 活侠传: 天命盘骰点、命运分支
- 紫微斗数: 十二宫、十四主星、四化

---

> CX 工作流 | 功能探讨
